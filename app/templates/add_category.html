{% extends "base.html" %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2><i class="bi bi-tag"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">–ì–ª–∞–≤–Ω–∞—è</a></li>
                            <li class="breadcrumb-item"><a href="{{ url_for('main.categories') }}">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
                            <li class="breadcrumb-item active">–î–æ–±–∞–≤–∏—Ç—å</li>
                        </ol>
                    </nav>
                </div>
                <div>
                    <a href="{{ url_for('main.categories') }}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                        <div class="mb-3">
                            <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="name" name="name" 
                                   required maxlength="100" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è"
                                   value="{{ request.form.get('name', '') }}">
                            <div class="form-text">–ö—Ä–∞—Ç–∫–æ–µ, –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                        </div>

                        <!-- –¢–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                        <div class="mb-3">
                            <label for="category_type" class="form-label">–¢–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ <span class="text-danger">*</span></label>
                            <select class="form-select" id="category_type" name="category_type" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                                <option value="income" {% if request.form.get('category_type') == 'income' or request.args.get('type') == 'income' %}selected{% endif %}>
                                    üí∞ –î–æ—Ö–æ–¥
                                </option>
                                <option value="expense" {% if request.form.get('category_type') == 'expense' or request.args.get('type') == 'expense' %}selected{% endif %}>
                                    üí∏ –†–∞—Å—Ö–æ–¥
                                </option>
                                <option value="transfer" {% if request.form.get('category_type') == 'transfer' or request.args.get('type') == 'transfer' %}selected{% endif %}>
                                    üîÑ –ü–µ—Ä–µ–≤–æ–¥
                                </option>
                            </select>
                            <div class="form-text">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</div>
                        </div>

                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                        <div class="mb-4">
                            <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea class="form-control" id="description" name="description" rows="3" 
                                      maxlength="255" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...">{{ request.form.get('description', '') }}</textarea>
                            <div class="form-text">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</div>
                        </div>

                        <!-- –ü—Ä–∏–º–µ—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <h6 class="alert-heading">üí° –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π:</h6>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <strong>üí∞ –î–æ—Ö–æ–¥—ã:</strong><br>
                                            <small class="text-muted">
                                                ‚Ä¢ –ó–∞—Ä–ø–ª–∞—Ç–∞<br>
                                                ‚Ä¢ –§—Ä–∏–ª–∞–Ω—Å<br>
                                                ‚Ä¢ –î–∏–≤–∏–¥–µ–Ω–¥—ã<br>
                                                ‚Ä¢ –ü–æ–¥–∞—Ä–∫–∏
                                            </small>
                                        </div>
                                        <div class="col-md-4">
                                            <strong>üí∏ –†–∞—Å—Ö–æ–¥—ã:</strong><br>
                                            <small class="text-muted">
                                                ‚Ä¢ –ü—Ä–æ–¥—É–∫—Ç—ã<br>
                                                ‚Ä¢ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç<br>
                                                ‚Ä¢ –ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ<br>
                                                ‚Ä¢ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è
                                            </small>
                                        </div>
                                        <div class="col-md-4">
                                            <strong>üîÑ –ü–µ—Ä–µ–≤–æ–¥—ã:</strong><br>
                                            <small class="text-muted">
                                                ‚Ä¢ –°–ë–ü –ø–µ—Ä–µ–≤–æ–¥—ã<br>
                                                ‚Ä¢ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç<br>
                                                ‚Ä¢ –°–Ω—è—Ç–∏–µ –Ω–∞–ª–∏—á–Ω—ã—Ö<br>
                                                ‚Ä¢ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                            </button>
                            <a href="{{ url_for('main.categories') }}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> –û—Ç–º–µ–Ω–∞
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è
document.getElementById('name').focus();

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∏–ø–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
document.getElementById('category_type').addEventListener('change', function() {
    const examples = {
        'income': ['–ó–∞—Ä–ø–ª–∞—Ç–∞', '–§—Ä–∏–ª–∞–Ω—Å', '–î–∏–≤–∏–¥–µ–Ω–¥—ã', '–ü–æ–¥–∞—Ä–∫–∏', '–ë–æ–Ω—É—Å—ã'],
        'expense': ['–ü—Ä–æ–¥—É–∫—Ç—ã', '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', '–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ', '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', '–û–¥–µ–∂–¥–∞'],
        'transfer': ['–°–ë–ü –ø–µ—Ä–µ–≤–æ–¥—ã', '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç', '–°–Ω—è—Ç–∏–µ –Ω–∞–ª–∏—á–Ω—ã—Ö', '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', '–°–±–µ—Ä–µ–∂–µ–Ω–∏—è']
    };
    
    if (this.value && !document.getElementById('name').value) {
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–ª–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏
    }
});

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
document.querySelector('form').addEventListener('submit', function(e) {
    const name = document.getElementById('name').value.trim();
    const categoryType = document.getElementById('category_type').value;
    
    if (!name) {
        e.preventDefault();
        document.getElementById('name').focus();
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
        return;
    }
    
    if (!categoryType) {
        e.preventDefault();
        document.getElementById('category_type').focus();
        alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
        return;
    }
    
    if (name.length < 2) {
        e.preventDefault();
        document.getElementById('name').focus();
        alert('–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
        return;
    }
});

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏ —Ç–∏–ø–∞
document.getElementById('name').addEventListener('blur', function() {
    const name = this.value.trim();
    const categoryType = document.getElementById('category_type').value;
    const description = document.getElementById('description');
    
    if (name && categoryType && !description.value) {
        let autoDescription = '';
        switch(categoryType) {
            case 'income':
                autoDescription = `–î–æ—Ö–æ–¥—ã –æ—Ç: ${name.toLowerCase()}`;
                break;
            case 'expense':
                autoDescription = `–†–∞—Å—Ö–æ–¥—ã –Ω–∞: ${name.toLowerCase()}`;
                break;
            case 'transfer':
                autoDescription = `–ü–µ—Ä–µ–≤–æ–¥—ã: ${name.toLowerCase()}`;
                break;
        }
        description.placeholder = autoDescription;
    }
});
</script>
{% endblock %}