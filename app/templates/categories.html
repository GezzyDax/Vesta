{% extends "base.html" %}

{% block title %}–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ - FamilyBudget{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1><i class="bi bi-tags"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h1>
    </div>
    <div class="col-md-4 text-end">
        <a href="{{ url_for('main.add_category') }}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        </a>
    </div>
</div>

<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6><i class="bi bi-bar-chart"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h6>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <h5 class="text-primary">{{ stats.total_categories }}</h5>
                        <p class="text-muted mb-0">–í—Å–µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>
                    </div>
                    <div class="col-md-3">
                        <h5 class="text-success">{{ stats.income_count }}</h5>
                        <p class="text-muted mb-0">–î–æ—Ö–æ–¥—ã</p>
                    </div>
                    <div class="col-md-3">
                        <h5 class="text-danger">{{ stats.expense_count }}</h5>
                        <p class="text-muted mb-0">–†–∞—Å—Ö–æ–¥—ã</p>
                    </div>
                    <div class="col-md-3">
                        <h5 class="text-info">{{ stats.transfer_count }}</h5>
                        <p class="text-muted mb-0">–ü–µ—Ä–µ–≤–æ–¥—ã</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ —Ç–∏–ø–∞–º -->
<div class="row">
    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤ -->
    <div class="col-lg-4 mb-4">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5><i class="bi bi-arrow-up-circle"></i> –î–æ—Ö–æ–¥—ã</h5>
            </div>
            <div class="card-body">
                {% if categories.income %}
                    <div class="list-group list-group-flush">
                        {% for category in categories.income %}
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ category.name }}</strong>
                                {% if category.description %}
                                <br><small class="text-muted">{{ category.description }}</small>
                                {% endif %}
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item" href="{{ url_for('main.edit_category', category_id=category.id) }}">
                                            <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item text-danger" href="#"
                                           onclick="confirmDelete({{ category.id }}, '{{ category.name }}', 'income')">
                                            <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-tags display-6 text-muted"></i>
                        <p class="text-muted mt-2">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–æ—Ö–æ–¥–æ–≤</p>
                        <a href="{{ url_for('main.add_category') }}?type=income" class="btn btn-outline-success btn-sm">
                            <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ -->
    <div class="col-lg-4 mb-4">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5><i class="bi bi-arrow-down-circle"></i> –†–∞—Å—Ö–æ–¥—ã</h5>
            </div>
            <div class="card-body">
                {% if categories.expense %}
                    <div class="list-group list-group-flush">
                        {% for category in categories.expense %}
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ category.name }}</strong>
                                {% if category.description %}
                                <br><small class="text-muted">{{ category.description }}</small>
                                {% endif %}
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item" href="{{ url_for('main.edit_category', category_id=category.id) }}">
                                            <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item text-danger" href="#"
                                           onclick="confirmDelete({{ category.id }}, '{{ category.name }}', 'expense')">
                                            <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-tags display-6 text-muted"></i>
                        <p class="text-muted mt-2">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤</p>
                        <a href="{{ url_for('main.add_category') }}?type=expense" class="btn btn-outline-danger btn-sm">
                            <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ -->
    <div class="col-lg-4 mb-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5><i class="bi bi-arrow-left-right"></i> –ü–µ—Ä–µ–≤–æ–¥—ã</h5>
            </div>
            <div class="card-body">
                {% if categories.transfer %}
                    <div class="list-group list-group-flush">
                        {% for category in categories.transfer %}
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ category.name }}</strong>
                                {% if category.description %}
                                <br><small class="text-muted">{{ category.description }}</small>
                                {% endif %}
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item" href="{{ url_for('main.edit_category', category_id=category.id) }}">
                                            <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item text-danger" href="#"
                                           onclick="confirmDelete({{ category.id }}, '{{ category.name }}', 'transfer')">
                                            <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-tags display-6 text-muted"></i>
                        <p class="text-muted mt-2">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–µ—Ä–µ–≤–æ–¥–æ–≤</p>
                        <a href="{{ url_for('main.add_category') }}?type=transfer" class="btn btn-outline-info btn-sm">
                            <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="modal fade" id="deleteCategoryModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="bi bi-exclamation-triangle"></i> –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p><strong>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é?</strong></p>
                <div class="alert alert-warning">
                    <div id="deleteCategoryInfo">
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>
                <p class="text-danger mb-0">
                    <i class="bi bi-exclamation-circle"></i> 
                    –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å! –ö–∞—Ç–µ–≥–æ—Ä–∏—è –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å –Ω–µ–π –Ω–µ —Å–≤—è–∑–∞–Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <form id="deleteCategoryForm" method="POST" class="d-inline">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash"></i> –î–∞, —É–¥–∞–ª–∏—Ç—å
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function confirmDelete(categoryId, categoryName, categoryType) {
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∫–æ–Ω–∫—É –ø–æ —Ç–∏–ø—É
    let typeIcon = '';
    let typeName = '';
    switch(categoryType) {
        case 'income':
            typeIcon = 'üí∞';
            typeName = '–î–æ—Ö–æ–¥';
            break;
        case 'expense':
            typeIcon = 'üí∏';
            typeName = '–†–∞—Å—Ö–æ–¥';
            break;
        case 'transfer':
            typeIcon = 'üîÑ';
            typeName = '–ü–µ—Ä–µ–≤–æ–¥';
            break;
    }
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const info = `
        <div class="row">
            <div class="col-sm-4"><strong>ID:</strong></div>
            <div class="col-sm-8">#${categoryId}</div>
        </div>
        <div class="row">
            <div class="col-sm-4"><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong></div>
            <div class="col-sm-8">${categoryName}</div>
        </div>
        <div class="row">
            <div class="col-sm-4"><strong>–¢–∏–ø:</strong></div>
            <div class="col-sm-8">${typeIcon} ${typeName}</div>
        </div>
    `;
    
    document.getElementById('deleteCategoryInfo').innerHTML = info;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º action —Ñ–æ—Ä–º—ã
    const deleteForm = document.getElementById('deleteCategoryForm');
    deleteForm.action = `/categories/${categoryId}/delete`;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = new bootstrap.Modal(document.getElementById('deleteCategoryModal'));
    modal.show();
}

// –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
document.addEventListener('DOMContentLoaded', function() {
    const listItems = document.querySelectorAll('.list-group-item');
    listItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#f8f9fa';
        });
        item.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
        });
    });
});
</script>
{% endblock %}